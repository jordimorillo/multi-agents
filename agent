#!/bin/bash
# Script para ejecutar el sistema multi-agente

# Colores para output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Directorio del script (resuelve symlinks para que /usr/local/bin/agent apunte al proyecto real)
if command -v readlink >/dev/null 2>&1; then
    SCRIPT_DIR="$( cd "$( dirname "$(readlink -f "${BASH_SOURCE[0]}")" )" && pwd )"
else
    # Fallback si no existe readlink -f
    SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
fi

# Cambiar al directorio del script
cd "$SCRIPT_DIR"

# Verificar que existe el venv
if [ ! -d "$SCRIPT_DIR/venv" ]; then
    echo -e "${RED}âŒ Error: Virtual environment no encontrado${NC}"
    echo "   Ejecuta primero: cd $SCRIPT_DIR && ./setup.sh"
    exit 1
fi

# Activar entorno virtual (con path absoluto)
source "$SCRIPT_DIR/venv/bin/activate"

# Si no hay argumentos, mostrar ayuda
if [ $# -eq 0 ]; then
    echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${GREEN}ğŸ¤– SISTEMA MULTI-AGENTE${NC}"
    echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo -e "${YELLOW}Uso:${NC}"
    echo "  ./agent \"<tu orden aquÃ­>\""
    echo ""
    echo -e "${YELLOW}Ejemplos:${NC}"
    echo "  ./agent \"Implementar traducciones a catalÃ¡n e inglÃ©s\""
    echo "  ./agent \"AÃ±adir autenticaciÃ³n OAuth\""
    echo "  ./agent \"Optimizar performance del frontend\""
    echo "  ./agent \"Crear sistema de comentarios\""
    echo ""
    echo -e "${YELLOW}Agentes disponibles:${NC}"
    echo "  ğŸ“ @fullstack-architect  - CoordinaciÃ³n y arquitectura"
    echo "  ğŸ’» @frontend-specialist  - Desarrollo frontend"
    echo "  ğŸ”§ @backend-specialist   - Desarrollo backend"
    echo "  ğŸš€ @devops-specialist    - DevOps, CI/CD e infraestructura"
    echo "  ï¸  @security-specialist  - Seguridad y auditorÃ­as"
    echo "  âš¡ @performance-specialist - OptimizaciÃ³n"
    echo "  âœ… @qa-specialist        - Testing y calidad"
    echo "  ğŸ“ˆ @seo-specialist       - SEO y optimizaciÃ³n web"
    echo "  ğŸ¨ @ux-specialist        - UX/UI y diseÃ±o"
    echo "  ğŸ“Š @data-specialist      - Datos, analytics y BI"
    echo "  ğŸ¤– @ai-specialist        - IA, ML y automatizaciÃ³n"
    echo "  ğŸ” @observer-optimizer   - AnÃ¡lisis y mejora continua"
    echo ""
    echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    exit 0
fi

# Ejecutar el CLI con el prompt del usuario
echo -e "${GREEN}ğŸš€ Iniciando sistema multi-agente...${NC}"
echo ""

python "$SCRIPT_DIR/cli.py" "$@"

# Capturar cÃ³digo de salida
EXIT_CODE=$?

if [ $EXIT_CODE -eq 0 ]; then
    echo ""
    echo -e "${GREEN}âœ… EjecuciÃ³n completada exitosamente${NC}"
else
    echo ""
    echo -e "${RED}âŒ Error en la ejecuciÃ³n (cÃ³digo: $EXIT_CODE)${NC}"
fi

exit $EXIT_CODE
